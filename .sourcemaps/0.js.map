{"version":3,"sources":["../../src/pages/checkout-payment/checkout-payment.module.ts","../../src/components/cart-progress/cart-progress.module.ts","../../src/components/cart-progress/cart-progress.ts","../../src/pages/checkout-payment/checkout-payment.ts"],"names":[],"mappings":"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","file":"0.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { CheckoutPaymentPage } from './checkout-payment';\r\nimport { CartProgressModule } from '../../components/cart-progress/cart-progress.module';\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n    CheckoutPaymentPage,\r\n  ],\r\n  imports: [\r\n    CartProgressModule,\r\n    IonicPageModule.forChild(CheckoutPaymentPage)\r\n  ],\r\n  entryComponents: [\r\n    CheckoutPaymentPage\r\n  ]\r\n})\r\nexport class CheckoutPaymentModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/checkout-payment/checkout-payment.module.ts","import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { CartProgress } from './cart-progress';\r\nimport { CommonModule } from '@angular/common';\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n    CartProgress,\r\n  ],\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  exports: [\r\n    CartProgress\r\n  ]\r\n})\r\nexport class CartProgressModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/cart-progress/cart-progress.module.ts","import { Component, Input, NgModule } from '@angular/core';\r\nimport { Button, Select } from 'ionic-angular';\r\n \r\n@Component({\r\n    selector: 'cart-progress',\r\n    templateUrl: 'cart-progress.html'\r\n})\r\nexport class CartProgress {\r\n\r\n    @Input('amount') amount: number;\r\n    @Input('current') current: number;\r\n\r\n    private elements: string[] = [\r\n        \"Details\",\r\n        \"Payment\",\r\n        \"Confirm\"\r\n    ]\r\n\r\n    getElements(): Array<number> {\r\n        return Array.from({length: this.amount}, (x,i) => i + 1);\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/components/cart-progress/cart-progress.ts","import {\r\n    Component\r\n} from \"@angular/core\";\r\nimport {\r\n    IonicPage,\r\n    ModalController,\r\n    NavController,\r\n    NavParams\r\n} from \"ionic-angular\";\r\nimport {\r\n    MoltinCart\r\n} from \"../../providers/moltin/models/cart\";\r\nimport { Moltin } from \"../../providers/moltin/moltin\";\r\n\r\ndeclare var Stripe: any;\r\n\r\n@IonicPage({\r\n    name: \"checkout-payment\",\r\n    segment: \"checkout-payment\"\r\n})\r\n@Component({\r\n    selector: \"page-checkout-payment\",\r\n    templateUrl: \"checkout-payment.html\"\r\n})\r\nexport class CheckoutPaymentPage {\r\n\r\n    private stripe = Stripe('pk_test_jpI6XzhcNeNPSGxicVyDJd2w');\r\n    private paymentRequest: any;\r\n    private card: any;\r\n    private canMakePayment: boolean = true;\r\n    private moltinCart: MoltinCart = this.navParams.get('cart');\r\n    private customer: {} = this.navParams.get('customer');\r\n\r\n    private selectedPaymentMethod: string = \"apple-pay\";\r\n    private formIsValid: boolean = false;\r\n\r\n    private promoCode: string;\r\n\r\n    constructor(\r\n        private navController: NavController,\r\n        private navParams: NavParams,\r\n        private moltin: Moltin\r\n    ) {\r\n        this.constructPaymentRequest();\r\n    }\r\n\r\n    ionViewDidLoad() {\r\n        this.mountPaymentButton();\r\n        this.constructPaymentForm();\r\n    }\r\n\r\n    constructPaymentRequest() {\r\n        let items = this.moltinCart.data.map(item => {\r\n            return {\r\n                \"amount\": item.meta.display_price.with_tax.value.amount,\r\n                \"label\": item.name\r\n            }\r\n        })\r\n        this.paymentRequest = this.stripe.paymentRequest({\r\n            country: 'US',\r\n            currency: this.moltinCart.meta.display_price.with_tax.currency.toLowerCase(),\r\n            total: {\r\n                label: 'Total Payment',\r\n                amount: this.moltinCart.meta.display_price.with_tax.amount,\r\n            },\r\n            requestPayerName: true,\r\n            requestPayerEmail: true,\r\n            displayItems: items\r\n        });\r\n\r\n        this.paymentRequest.on('token', (ev) => {\r\n            ev.complete('success');\r\n            this.moveToConfirmationPage(ev.token);\r\n        });\r\n\r\n        this.paymentRequest.on('error', (ev) => {\r\n            console.log(ev);\r\n        });\r\n\r\n        this.paymentRequest.on('cancel', (ev) => {\r\n            console.log(ev);\r\n        })\r\n    }\r\n\r\n    mountPaymentButton() {\r\n        const elements = this.stripe.elements();\r\n        const prButton = elements.create('paymentRequestButton', {\r\n            \"paymentRequest\": this.paymentRequest,\r\n            style: {\r\n                paymentRequestButton: {\r\n                    theme: 'light-outline',\r\n                    height: '44px',\r\n                },\r\n            },\r\n        });\r\n\r\n        (async () => {\r\n            // Check the availability of the Payment Request API first.\r\n            const result = await this.paymentRequest.canMakePayment();\r\n            if (result) {\r\n                prButton.mount('#payment-request-button');\r\n            } else {\r\n                this.canMakePayment = false;\r\n                this.selectedPaymentMethod = \"card\";\r\n            }\r\n        })();\r\n    }\r\n\r\n    constructPaymentForm() {\r\n        this.card = this.stripe.elements().create('card', {\r\n            hidePostalCode: true\r\n        });\r\n        this.card.mount(\"#card-element\");\r\n\r\n        this.card.on('change', (ev) => {\r\n            this.formIsValid = ev.complete;\r\n        });\r\n    }\r\n\r\n    applyPromoCode() {\r\n        this.moltin.applyPromoCode(this.promoCode).subscribe(\r\n            data => console.log(data),\r\n            error => console.error(error)\r\n        )\r\n    }\r\n\r\n    confirmOrder() {\r\n        if (this.selectedPaymentMethod == \"card\") {\r\n            this.stripe.createToken(this.card).then((result) => {\r\n                if (result.error) {\r\n                    console.error(result.error);\r\n                } else {\r\n                    this.moveToConfirmationPage(result.token);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    moveToConfirmationPage(token) {\r\n        this.navController.push('checkout-confirmation', {\r\n            'customer': this.customer,\r\n            'token': token\r\n        });\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/checkout-payment/checkout-payment.ts"],"sourceRoot":""}